name: Botcii CI

on:
  push:
    branches: [ "main" ]
  # pull_request:
  #   branches: [ "main" ]

jobs:
  build:

    runs-on: self-hosted

    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: 20.x
    - run: npm install
    - run: npm install typescript -g

    - name: Build app
      run: tsc
    - name: Give rights for execute
      run: chmod 755 ./dist/bot.js
    - name: Create env file
      run: |
        touch .env
        echo TOKEN=${{ secrets.TOKEN }} >> .env
        echo CLIENTID=${{ secrets.CLIENTID }} >> .env
        echo MODE=${{ secrets.MODE }} >> .env
    - name: Run app
      run: pm2 restart botcii